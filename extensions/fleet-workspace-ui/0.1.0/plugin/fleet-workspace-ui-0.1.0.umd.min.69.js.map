{"version":3,"file":"fleet-workspace-ui-0.1.0.umd.min.69.js","mappings":"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","sources":["webpack://fleet-workspace-ui-0.1.0/./components/FleetMembershipEditor.vue?410a","webpack://fleet-workspace-ui-0.1.0/./components/FleetMembershipEditor.vue","webpack://fleet-workspace-ui-0.1.0/./components/FleetMembershipEditor.vue?41da","webpack://fleet-workspace-ui-0.1.0/./components/FleetMembershipEditor.vue?1616"],"sourcesContent":["// Imports\nimport ___CSS_LOADER_API_NO_SOURCEMAP_IMPORT___ from \"../../../node_modules/css-loader/dist/runtime/noSourceMaps.js\";\nimport ___CSS_LOADER_API_IMPORT___ from \"../../../node_modules/css-loader/dist/runtime/api.js\";\nvar ___CSS_LOADER_EXPORT___ = ___CSS_LOADER_API_IMPORT___(___CSS_LOADER_API_NO_SOURCEMAP_IMPORT___);\n// Module\n___CSS_LOADER_EXPORT___.push([module.id, \".role[data-v-349939ba]{display:flex;align-items:center;flex-direction:row}\", \"\"]);\n// Exports\nexport default ___CSS_LOADER_EXPORT___;\n","<template>\n  <div>\n    <Loading v-if=\"loading\" />\n    <div v-else>\n      <ArrayList\n          v-model:value=\"members\"\n          :addAllowed=\"!disableEdit\"\n          :removeAllowed=\"!disableEdit\"\n          :show-header=\"true\"\n      >\n        <template #column-headers>\n          <div class=\"box mb-0\">\n            <div class=\"column-headers row\">\n              <div class=\"col span-6\">\n                <label class=\"text-label\">{{ t('membershipEditor.user') }}</label>\n              </div>\n              <div class=\"col span-6\">\n                <label class=\"text-label\">{{ t('membershipEditor.role') }}</label>\n              </div>\n            </div>\n          </div>\n        </template>\n        <template #columns=\"{ row, i }\">\n\n          <div class=\"columns row\">\n            <div class=\"col span-6\">\n              <Principal :value=\"row.value.principalId\" />\n            </div>\n            <div class=\"col span-6 role\">\n              {{ row.value.role }}\n            </div>\n          </div>\n        </template>\n        <template #add>\n          <button\n              type=\"button\"\n              class=\"btn role-primary mt-10\"\n              @click=\"openAddMemberDialog\"\n          >\n            {{ t('generic.add') }}\n          </button>\n        </template>\n        <template #remove-button=\"{ remove, i }\">\n          <button\n              type=\"button\"\n              class=\"btn role-secondary mt-10\"\n              @click=\"removeMember(i)\"\n          >\n            {{ t('generic.remove') }}\n          </button>\n        </template>\n      </ArrayList>\n    </div>\n  </div>\n</template>\n\n<script>\nimport { mapGetters } from 'vuex';\nimport ArrayList from '@shell/components/form/ArrayList';\nimport Principal from '@shell/components/auth/Principal';\nimport Loading from '@shell/components/Loading';\nimport SelectPrincipal from '@shell/components/auth/SelectPrincipal';\n\nexport default {\n  components: {\n    ArrayList,\n    Principal,\n    Loading,\n    SelectPrincipal,\n  },\n  props: {\n    value: Object,\n  },\n  data() {\n    return {\n      loading: true,\n      members: [],\n      workspace: Object,\n      currentPrincipal: \"\",\n      disableEdit: true,\n    };\n  },\n  watch: {\n    'workspace.metadata.annotations': {\n      handler() {\n        this.loadMembers();\n      },\n      deep: true,\n    },\n  },\n  computed: {\n    ...mapGetters(['currentCluster']),\n  },\n  async created() {\n    this.currentPrincipal = this.$store.getters['auth/principalId'];\n    const fleetWorkspaceId = this.$route.params.id;\n    [this.workspace] = await Promise.all([ this.$store.dispatch('management/find', {\n      type: 'management.cattle.io.fleetworkspace',\n      id: fleetWorkspaceId,\n    })]);\n    if (!this.workspace) {\n      throw new Error('Failed to fetch fleet workspace');\n    }\n    await this.loadMembers();\n    this.loading = false;\n  },\n  methods: {\n    async loadMembers() {\n      const annotations = this.workspace?.metadata?.annotations || {};\n      let disableEdit = true\n      this.members = Object.entries(annotations)\n          .filter(([key]) => key.startsWith('gorizond-user.'))\n          .map(([key]) => {\n            const parts = key.split('.');\n            const principalId = `local://${parts[1]}`;\n            const role = parts[2];\n            if (principalId === this.currentPrincipal && (role === 'admin' ||role === 'editor')) {\n              disableEdit = false;\n            }\n            return {\n              principalId: principalId,\n              role: role,\n            };\n          });\n      this.disableEdit = disableEdit;\n    },\n    async openAddMemberDialog() {\n      this.$store.dispatch('cluster/promptModal', {\n        component: 'AddFleetMemberDialog',\n        componentProps: {\n          onAdd: this.addMember,\n        },\n        modalWidth: '600px',\n        modalSticky: true,\n      });\n    },\n    async addMember(principalId, role) {\n      const key = `gorizond-user.${principalId.split('//').pop()}.${role}`;\n      const annotations = {\n        ...this.workspace.metadata.annotations,\n        [key]: Date.now(),\n      };\n      await this.updateAnnotations(annotations);\n    },\n    async removeMember(index) {\n      const member = this.members[index];\n      const key = `gorizond-user.${member.principalId.split('//').pop()}.${member.role}`;\n      const annotations = { ...this.workspace.metadata.annotations };\n      delete annotations[key];\n      await this.updateAnnotations(annotations);\n    },\n    async updateAnnotations(annotations) {\n      let oldannotations = this.workspace.metadata.annotations\n      try {\n        this.workspace.metadata.annotations = annotations;\n        await this.workspace.save();\n      } catch (error) {\n        this.$store.dispatch('growl/error', {\n          title:   'Error',\n          message: error.message,\n        }, { root: true });\n        this.workspace.metadata.annotations = oldannotations;\n      }\n    },\n  },\n};\n</script>\n\n<style scoped>\n.role {\n  display: flex;\n  align-items: center;\n  flex-direction: row;\n}\n</style>\n","import { render } from \"./FleetMembershipEditor.vue?vue&type=template&id=349939ba&scoped=true\"\nimport script from \"./FleetMembershipEditor.vue?vue&type=script&lang=js\"\nexport * from \"./FleetMembershipEditor.vue?vue&type=script&lang=js\"\n\nimport \"./FleetMembershipEditor.vue?vue&type=style&index=0&id=349939ba&scoped=true&lang=css\"\n\nimport exportComponent from \"../../../node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render],['__scopeId',\"data-v-349939ba\"]])\n\nexport default __exports__","// style-loader: Adds some css to the DOM by adding a <style> tag\n\n// load the styles\nvar content = require(\"!!../../../node_modules/css-loader/dist/cjs.js??clonedRuleSet-13.use[1]!../../../node_modules/vue-loader/dist/stylePostLoader.js!../../../node_modules/postcss-loader/dist/cjs.js??clonedRuleSet-13.use[2]!../../../node_modules/postcss-loader/dist/cjs.js??clonedRuleSet-13.use[3]!../../../node_modules/cache-loader/dist/cjs.js??ruleSet[0].use[0]!../../../node_modules/vue-loader/dist/index.js??ruleSet[0].use[1]!./FleetMembershipEditor.vue?vue&type=style&index=0&id=349939ba&scoped=true&lang=css\");\nif(content.__esModule) content = content.default;\nif(typeof content === 'string') content = [[module.id, content, '']];\nif(content.locals) module.exports = content.locals;\n// add the styles to the DOM\nvar add = require(\"!../../../node_modules/vue-style-loader/lib/addStylesClient.js\").default\nvar update = add(\"3aa70447\", content, true, {\"sourceMap\":false,\"shadowMode\":false});"],"names":["___CSS_LOADER_EXPORT___","push","module","id","key","class","_createElementBlock","$data","loading","_createBlock","_component_Loading","_hoisted_1","_createVNode","_component_ArrayList","value","members","_cache","$event","addAllowed","disableEdit","removeAllowed","_withCtx","_createElementVNode","_hoisted_2","_hoisted_3","_hoisted_4","_hoisted_5","_toDisplayString","_ctx","t","_hoisted_6","_hoisted_7","columns","row","i","_hoisted_8","_hoisted_9","_component_Principal","principalId","_hoisted_10","role","add","type","onClick","args","$options","openAddMemberDialog","remove","removeMember","_hoisted_11","_","components","ArrayList","Principal","Loading","SelectPrincipal","props","Object","data","workspace","currentPrincipal","watch","handler","this","loadMembers","deep","computed","mapGetters","created","$store","getters","fleetWorkspaceId","$route","params","Promise","all","dispatch","Error","methods","annotations","metadata","entries","filter","startsWith","map","parts","split","component","componentProps","onAdd","addMember","modalWidth","modalSticky","pop","Date","now","updateAnnotations","index","member","oldannotations","save","error","title","message","root","__exports__","render","content","__esModule","default","locals","exports"],"sourceRoot":""}