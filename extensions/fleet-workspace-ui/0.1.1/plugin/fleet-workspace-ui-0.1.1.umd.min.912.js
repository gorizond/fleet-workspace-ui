(("undefined"!==typeof self?self:this)["webpackChunkfleet_workspace_ui_0_1_1"]=("undefined"!==typeof self?self:this)["webpackChunkfleet_workspace_ui_0_1_1"]||[]).push([[912],{999:function(e,t,a){"use strict";a.r(t);var o=a(6758),s=a.n(o),r=a(6173),n=a.n(r),i=n()(s());i.push([e.id,".role[data-v-65bd8d75]{display:flex;align-items:center;flex-direction:row}",""]),t["default"]=i},7504:function(e,t,a){var o=a(999);o.__esModule&&(o=o.default),"string"===typeof o&&(o=[[e.id,o,""]]),o.locals&&(e.exports=o.locals);var s=a(4825).A;s("5f7952c2",o,!0,{sourceMap:!1,shadowMode:!1})},8912:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return M}});var o=a(9274);const s={key:1},r={class:"box mb-0"},n={class:"column-headers row"},i={class:"col span-6"},l={class:"text-label"},d={class:"col span-6"},c={class:"text-label"},p={class:"columns row"},m={class:"col span-6"},u={class:"col span-6 role"},h=["onClick"];function b(e,t,a,b,w,v){const k=(0,o.resolveComponent)("Loading"),f=(0,o.resolveComponent)("Principal"),g=(0,o.resolveComponent)("ArrayList");return(0,o.openBlock)(),(0,o.createElementBlock)("div",null,[w.loading?((0,o.openBlock)(),(0,o.createBlock)(k,{key:0})):((0,o.openBlock)(),(0,o.createElementBlock)("div",s,[(0,o.createVNode)(g,{value:w.members,"onUpdate:value":t[1]||(t[1]=e=>w.members=e),addAllowed:!w.disableEdit,removeAllowed:!w.disableEdit,"show-header":!0},{"column-headers":(0,o.withCtx)((()=>[(0,o.createElementVNode)("div",r,[(0,o.createElementVNode)("div",n,[(0,o.createElementVNode)("div",i,[(0,o.createElementVNode)("label",l,(0,o.toDisplayString)(e.t("membershipEditor.user")),1)]),(0,o.createElementVNode)("div",d,[(0,o.createElementVNode)("label",c,(0,o.toDisplayString)(e.t("membershipEditor.role")),1)])])])])),columns:(0,o.withCtx)((({row:e,i:t})=>[(0,o.createElementVNode)("div",p,[(0,o.createElementVNode)("div",m,[(0,o.createVNode)(f,{value:e.value.principalId},null,8,["value"])]),(0,o.createElementVNode)("div",u,(0,o.toDisplayString)(e.value.role),1)])])),add:(0,o.withCtx)((()=>[(0,o.createElementVNode)("button",{type:"button",class:"btn role-primary mt-10",onClick:t[0]||(t[0]=(...e)=>v.openAddMemberDialog&&v.openAddMemberDialog(...e))},(0,o.toDisplayString)(e.t("generic.add")),1)])),"remove-button":(0,o.withCtx)((({remove:t,i:a})=>[(0,o.createElementVNode)("button",{type:"button",class:"btn role-secondary mt-10",onClick:e=>v.removeMember(a)},(0,o.toDisplayString)(e.t("generic.remove")),9,h)])),_:1},8,["value","addAllowed","removeAllowed"])]))])}var w=a(5359),v=a(2017),k=a(4307),f=a(4409),g=a(6968),y={components:{ArrayList:v.A,Principal:k.A,Loading:f.A,SelectPrincipal:g.A},props:{value:Object},data(){return{loading:!0,members:[],workspace:Object,disableEdit:!0}},watch:{"workspace.metadata.annotations":{handler(){this.loadMembers()},deep:!0}},computed:{...(0,w.L8)(["currentCluster"])},async created(){const e=this.$route.params.id;if([this.workspace]=await Promise.all([this.$store.dispatch("management/find",{type:"management.cattle.io.fleetworkspace",id:e})]),!this.workspace)throw new Error("Failed to fetch fleet workspace");await this.loadMembers(),this.loading=!1},methods:{async loadMembers(){const e=this.workspace?.metadata?.annotations||{};let t=!0;this.members=Object.entries(e).filter((([e])=>e.startsWith("gorizond-user."))).map((([e])=>{const a=e.split("."),o=`local://${a[1]}`,s=a[2];return a[1]!==this.$store.getters["auth/v3User"].id||"admin"!==s&&"editor"!==s||(t=!1),{principalId:o,role:s}})),this.disableEdit=t},async openAddMemberDialog(){this.$store.dispatch("cluster/promptModal",{component:"AddFleetMemberDialog",componentProps:{onAdd:this.addMember},modalWidth:"600px",modalSticky:!0})},async addMember(e,t){const a=`gorizond-user.${e.split("//").pop()}.${t}`,o={...this.workspace.metadata.annotations,[a]:Date.now()};await this.updateAnnotations(o)},async removeMember(e){const t=this.members[e],a=`gorizond-user.${t.principalId.split("//").pop()}.${t.role}`,o={...this.workspace.metadata.annotations};delete o[a],await this.updateAnnotations(o)},async updateAnnotations(e){let t=this.workspace.metadata.annotations;try{this.workspace.metadata.annotations=e,await this.workspace.save()}catch(a){this.$store.dispatch("growl/error",{title:"Error",message:a.message},{root:!0}),this.workspace.metadata.annotations=t}}}},E=(a(7504),a(7433));const A=(0,E.A)(y,[["render",b],["__scopeId","data-v-65bd8d75"]]);var M=A}}]);
//# sourceMappingURL=fleet-workspace-ui-0.1.1.umd.min.912.js.map