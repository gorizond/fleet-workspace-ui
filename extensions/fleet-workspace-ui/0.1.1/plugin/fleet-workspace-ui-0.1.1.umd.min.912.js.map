{"version":3,"file":"fleet-workspace-ui-0.1.1.umd.min.912.js","mappings":"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","sources":["webpack://fleet-workspace-ui-0.1.1/./components/FleetMembershipEditor.vue?2258","webpack://fleet-workspace-ui-0.1.1/./components/FleetMembershipEditor.vue?5b77","webpack://fleet-workspace-ui-0.1.1/./components/FleetMembershipEditor.vue","webpack://fleet-workspace-ui-0.1.1/./components/FleetMembershipEditor.vue?41da"],"sourcesContent":["// Imports\nimport ___CSS_LOADER_API_NO_SOURCEMAP_IMPORT___ from \"../../../node_modules/css-loader/dist/runtime/noSourceMaps.js\";\nimport ___CSS_LOADER_API_IMPORT___ from \"../../../node_modules/css-loader/dist/runtime/api.js\";\nvar ___CSS_LOADER_EXPORT___ = ___CSS_LOADER_API_IMPORT___(___CSS_LOADER_API_NO_SOURCEMAP_IMPORT___);\n// Module\n___CSS_LOADER_EXPORT___.push([module.id, \".role[data-v-65bd8d75]{display:flex;align-items:center;flex-direction:row}\", \"\"]);\n// Exports\nexport default ___CSS_LOADER_EXPORT___;\n","// style-loader: Adds some css to the DOM by adding a <style> tag\n\n// load the styles\nvar content = require(\"!!../../../node_modules/css-loader/dist/cjs.js??clonedRuleSet-13.use[1]!../../../node_modules/vue-loader/dist/stylePostLoader.js!../../../node_modules/postcss-loader/dist/cjs.js??clonedRuleSet-13.use[2]!../../../node_modules/postcss-loader/dist/cjs.js??clonedRuleSet-13.use[3]!../../../node_modules/cache-loader/dist/cjs.js??ruleSet[0].use[0]!../../../node_modules/vue-loader/dist/index.js??ruleSet[0].use[1]!./FleetMembershipEditor.vue?vue&type=style&index=0&id=65bd8d75&scoped=true&lang=css\");\nif(content.__esModule) content = content.default;\nif(typeof content === 'string') content = [[module.id, content, '']];\nif(content.locals) module.exports = content.locals;\n// add the styles to the DOM\nvar add = require(\"!../../../node_modules/vue-style-loader/lib/addStylesClient.js\").default\nvar update = add(\"5f7952c2\", content, true, {\"sourceMap\":false,\"shadowMode\":false});","<template>\n  <div>\n    <Loading v-if=\"loading\" />\n    <div v-else>\n      <ArrayList\n          v-model:value=\"members\"\n          :addAllowed=\"!disableEdit\"\n          :removeAllowed=\"!disableEdit\"\n          :show-header=\"true\"\n      >\n        <template #column-headers>\n          <div class=\"box mb-0\">\n            <div class=\"column-headers row\">\n              <div class=\"col span-6\">\n                <label class=\"text-label\">{{ t('membershipEditor.user') }}</label>\n              </div>\n              <div class=\"col span-6\">\n                <label class=\"text-label\">{{ t('membershipEditor.role') }}</label>\n              </div>\n            </div>\n          </div>\n        </template>\n        <template #columns=\"{ row, i }\">\n\n          <div class=\"columns row\">\n            <div class=\"col span-6\">\n              <Principal :value=\"row.value.principalId\" />\n            </div>\n            <div class=\"col span-6 role\">\n              {{ row.value.role }}\n            </div>\n          </div>\n        </template>\n        <template #add>\n          <button\n              type=\"button\"\n              class=\"btn role-primary mt-10\"\n              @click=\"openAddMemberDialog\"\n          >\n            {{ t('generic.add') }}\n          </button>\n        </template>\n        <template #remove-button=\"{ remove, i }\">\n          <button\n              type=\"button\"\n              class=\"btn role-secondary mt-10\"\n              @click=\"removeMember(i)\"\n          >\n            {{ t('generic.remove') }}\n          </button>\n        </template>\n      </ArrayList>\n    </div>\n  </div>\n</template>\n\n<script>\nimport { mapGetters } from 'vuex';\nimport ArrayList from '@shell/components/form/ArrayList';\nimport Principal from '@shell/components/auth/Principal';\nimport Loading from '@shell/components/Loading';\nimport SelectPrincipal from '@shell/components/auth/SelectPrincipal';\n\nexport default {\n  components: {\n    ArrayList,\n    Principal,\n    Loading,\n    SelectPrincipal,\n  },\n  props: {\n    value: Object,\n  },\n  data() {\n    return {\n      loading: true,\n      members: [],\n      workspace: Object,\n      disableEdit: true,\n    };\n  },\n  watch: {\n    'workspace.metadata.annotations': {\n      handler() {\n        this.loadMembers();\n      },\n      deep: true,\n    },\n  },\n  computed: {\n    ...mapGetters(['currentCluster']),\n  },\n  async created() {\n    const fleetWorkspaceId = this.$route.params.id;\n    [this.workspace] = await Promise.all([ this.$store.dispatch('management/find', {\n      type: 'management.cattle.io.fleetworkspace',\n      id: fleetWorkspaceId,\n    })]);\n    if (!this.workspace) {\n      throw new Error('Failed to fetch fleet workspace');\n    }\n    await this.loadMembers();\n    this.loading = false;\n  },\n  methods: {\n    async loadMembers() {\n      const annotations = this.workspace?.metadata?.annotations || {};\n      let disableEdit = true\n      this.members = Object.entries(annotations)\n          .filter(([key]) => key.startsWith('gorizond-user.'))\n          .map(([key]) => {\n            const parts = key.split('.');\n            const principalId = `local://${parts[1]}`;\n            const role = parts[2];\n            if (parts[1] === this.$store.getters['auth/v3User'].id && (role === 'admin' ||role === 'editor')) {\n              disableEdit = false;\n            }\n            return {\n              principalId: principalId,\n              role: role,\n            };\n          });\n      this.disableEdit = disableEdit;\n    },\n    async openAddMemberDialog() {\n      this.$store.dispatch('cluster/promptModal', {\n        component: 'AddFleetMemberDialog',\n        componentProps: {\n          onAdd: this.addMember,\n        },\n        modalWidth: '600px',\n        modalSticky: true,\n      });\n    },\n    async addMember(principalId, role) {\n      const key = `gorizond-user.${principalId.split('//').pop()}.${role}`;\n      const annotations = {\n        ...this.workspace.metadata.annotations,\n        [key]: Date.now(),\n      };\n      await this.updateAnnotations(annotations);\n    },\n    async removeMember(index) {\n      const member = this.members[index];\n      const key = `gorizond-user.${member.principalId.split('//').pop()}.${member.role}`;\n      const annotations = { ...this.workspace.metadata.annotations };\n      delete annotations[key];\n      await this.updateAnnotations(annotations);\n    },\n    async updateAnnotations(annotations) {\n      let oldannotations = this.workspace.metadata.annotations\n      try {\n        this.workspace.metadata.annotations = annotations;\n        await this.workspace.save();\n      } catch (error) {\n        this.$store.dispatch('growl/error', {\n          title:   'Error',\n          message: error.message,\n        }, { root: true });\n        this.workspace.metadata.annotations = oldannotations;\n      }\n    },\n  },\n};\n</script>\n\n<style scoped>\n.role {\n  display: flex;\n  align-items: center;\n  flex-direction: row;\n}\n</style>\n","import { render } from \"./FleetMembershipEditor.vue?vue&type=template&id=65bd8d75&scoped=true\"\nimport script from \"./FleetMembershipEditor.vue?vue&type=script&lang=js\"\nexport * from \"./FleetMembershipEditor.vue?vue&type=script&lang=js\"\n\nimport \"./FleetMembershipEditor.vue?vue&type=style&index=0&id=65bd8d75&scoped=true&lang=css\"\n\nimport exportComponent from \"../../../node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render],['__scopeId',\"data-v-65bd8d75\"]])\n\nexport default __exports__"],"names":["___CSS_LOADER_EXPORT___","push","module","id","content","__esModule","default","locals","exports","add","key","class","_createElementBlock","$data","loading","_createBlock","_component_Loading","_hoisted_1","_createVNode","_component_ArrayList","value","members","_cache","$event","addAllowed","disableEdit","removeAllowed","_withCtx","_createElementVNode","_hoisted_2","_hoisted_3","_hoisted_4","_hoisted_5","_toDisplayString","_ctx","t","_hoisted_6","_hoisted_7","columns","row","i","_hoisted_8","_hoisted_9","_component_Principal","principalId","_hoisted_10","role","type","onClick","args","$options","openAddMemberDialog","remove","removeMember","_hoisted_11","_","components","ArrayList","Principal","Loading","SelectPrincipal","props","Object","data","workspace","watch","handler","this","loadMembers","deep","computed","mapGetters","created","fleetWorkspaceId","$route","params","Promise","all","$store","dispatch","Error","methods","annotations","metadata","entries","filter","startsWith","map","parts","split","getters","component","componentProps","onAdd","addMember","modalWidth","modalSticky","pop","Date","now","updateAnnotations","index","member","oldannotations","save","error","title","message","root","__exports__","render"],"sourceRoot":""}