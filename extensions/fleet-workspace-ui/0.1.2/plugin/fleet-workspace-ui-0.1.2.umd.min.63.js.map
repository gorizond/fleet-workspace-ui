{"version":3,"file":"fleet-workspace-ui-0.1.2.umd.min.63.js","mappings":"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","sources":["webpack://fleet-workspace-ui-0.1.2/./components/FleetMembershipEditor.vue","webpack://fleet-workspace-ui-0.1.2/./components/FleetMembershipEditor.vue?41da","webpack://fleet-workspace-ui-0.1.2/./components/FleetMembershipEditor.vue?d6ec","webpack://fleet-workspace-ui-0.1.2/./components/FleetMembershipEditor.vue?1d19"],"sourcesContent":["<template>\n  <div>\n    <Loading v-if=\"loading\" />\n    <div v-else>\n      <ArrayList\n          v-model:value=\"members\"\n          :addAllowed=\"!disableEdit\"\n          :removeAllowed=\"!disableEdit\"\n          :show-header=\"true\"\n      >\n        <template #column-headers>\n          <div class=\"box mb-0\">\n            <div class=\"column-headers row\">\n              <div class=\"col span-6\">\n                <label class=\"text-label\">{{ t('membershipEditor.user') }}</label>\n              </div>\n              <div class=\"col span-6\">\n                <label class=\"text-label\">{{ t('membershipEditor.role') }}</label>\n              </div>\n            </div>\n          </div>\n        </template>\n        <template #columns=\"{ row, i }\">\n\n          <div class=\"columns row\">\n            <div class=\"col span-6\">\n              <Principal :value=\"row.value.principalId\" />\n            </div>\n            <div class=\"col span-6 role\">\n              {{ row.value.role }}\n            </div>\n          </div>\n        </template>\n        <template #add>\n          <button\n              type=\"button\"\n              class=\"btn role-primary mt-10 \"\n              @click=\"openAddMemberDialog\"\n          >\n            {{ t('generic.add') }}\n          </button>\n        </template>\n        <template #remove-button=\"{ remove, i }\">\n          <button\n              type=\"button\"\n              class=\"btn role-secondary mt-10\"\n              @click=\"removeMember(i)\"\n          >\n            {{ t('generic.remove') }}\n          </button>\n        </template>\n      </ArrayList>\n    </div>\n  </div>\n</template>\n\n<script>\nimport { mapGetters } from 'vuex';\nimport ArrayList from '@shell/components/form/ArrayList';\nimport Principal from '@shell/components/auth/Principal';\nimport Loading from '@shell/components/Loading';\nimport SelectPrincipal from '@shell/components/auth/SelectPrincipal';\n\nexport default {\n  components: {\n    ArrayList,\n    Principal,\n    Loading,\n    SelectPrincipal,\n  },\n  props: {\n    value: Object,\n  },\n  data() {\n    return {\n      loading: true,\n      members: [],\n      workspace: Object,\n      disableEdit: true,\n    };\n  },\n  watch: {\n    'workspace.metadata.annotations': {\n      handler() {\n        this.loadMembers();\n      },\n      deep: true,\n    },\n  },\n  computed: {\n    ...mapGetters(['currentCluster']),\n  },\n  async created() {\n    const fleetWorkspaceId = this.$route.params.id;\n    [this.workspace] = await Promise.all([ this.$store.dispatch('management/find', {\n      type: 'management.cattle.io.fleetworkspace',\n      id: fleetWorkspaceId,\n    })]);\n    if (!this.workspace) {\n      throw new Error('Failed to fetch fleet workspace');\n    }\n    await this.loadMembers();\n    this.loading = false;\n  },\n  methods: {\n    async loadMembers() {\n      const annotations = this.workspace?.metadata?.annotations || {};\n      let disableEdit = true\n      this.members = Object.entries(annotations)\n          .filter(([key]) => key.startsWith('gorizond-user.'))\n          .map(([key, value]) => {\n            const parts = key.split('.');\n            const userID = parts[1];\n            const role = parts[2];\n            if (userID === this.$store.getters['auth/v3User'].id && (role === 'admin' ||role === 'editor')) {\n              disableEdit = false;\n            }\n            return {\n              principalId: value,\n              userID: userID,\n              role: role,\n            };\n          });\n      this.disableEdit = disableEdit;\n    },\n    async openAddMemberDialog() {\n      this.$store.dispatch('cluster/promptModal', {\n        component: 'AddFleetMemberDialog',\n        componentProps: {\n          onAdd: this.addMember,\n        },\n        modalWidth: '600px',\n        modalSticky: true,\n      });\n    },\n    async addMember(principalId, role) {\n      const principalIdSplit = principalId.split('://');\n      let value = principalId;\n      let key = `gorizond-user.${principalIdSplit[1]}.${role}`;\n      if (principalIdSplit[0] !== 'local') {\n        let random = Math.random().toString(36).substring(2) + Date.now();\n        key = `gorizond-principal.${random}.${role}`;\n        value = principalId;\n      }\n      const annotations = {\n        ...this.workspace.metadata.annotations,\n        [key]: value,\n      };\n      await this.updateAnnotations(annotations);\n    },\n    async removeMember(index) {\n      const member = this.members[index];\n      const key = `gorizond-user.${member.userID}.${member.role}`;\n      const annotations = { ...this.workspace.metadata.annotations };\n      delete annotations[key];\n      await this.updateAnnotations(annotations);\n    },\n    async updateAnnotations(annotations) {\n      let oldannotations = this.workspace.metadata.annotations\n      try {\n        this.workspace.metadata.annotations = annotations;\n        await this.workspace.save();\n      } catch (error) {\n        this.$store.dispatch('growl/error', {\n          title:   'Error',\n          message: error.message,\n        }, { root: true });\n        this.workspace.metadata.annotations = oldannotations;\n      }\n    },\n  },\n};\n</script>\n\n<style scoped>\n.role {\n  display: flex;\n  align-items: center;\n  flex-direction: row;\n}\n</style>\n","import { render } from \"./FleetMembershipEditor.vue?vue&type=template&id=3b5921fe&scoped=true\"\nimport script from \"./FleetMembershipEditor.vue?vue&type=script&lang=js\"\nexport * from \"./FleetMembershipEditor.vue?vue&type=script&lang=js\"\n\nimport \"./FleetMembershipEditor.vue?vue&type=style&index=0&id=3b5921fe&scoped=true&lang=css\"\n\nimport exportComponent from \"../../../node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render],['__scopeId',\"data-v-3b5921fe\"]])\n\nexport default __exports__","// style-loader: Adds some css to the DOM by adding a <style> tag\n\n// load the styles\nvar content = require(\"!!../../../node_modules/css-loader/dist/cjs.js??clonedRuleSet-13.use[1]!../../../node_modules/vue-loader/dist/stylePostLoader.js!../../../node_modules/postcss-loader/dist/cjs.js??clonedRuleSet-13.use[2]!../../../node_modules/postcss-loader/dist/cjs.js??clonedRuleSet-13.use[3]!../../../node_modules/cache-loader/dist/cjs.js??ruleSet[0].use[0]!../../../node_modules/vue-loader/dist/index.js??ruleSet[0].use[1]!./FleetMembershipEditor.vue?vue&type=style&index=0&id=3b5921fe&scoped=true&lang=css\");\nif(content.__esModule) content = content.default;\nif(typeof content === 'string') content = [[module.id, content, '']];\nif(content.locals) module.exports = content.locals;\n// add the styles to the DOM\nvar add = require(\"!../../../node_modules/vue-style-loader/lib/addStylesClient.js\").default\nvar update = add(\"bf4632c8\", content, true, {\"sourceMap\":false,\"shadowMode\":false});","// Imports\nimport ___CSS_LOADER_API_NO_SOURCEMAP_IMPORT___ from \"../../../node_modules/css-loader/dist/runtime/noSourceMaps.js\";\nimport ___CSS_LOADER_API_IMPORT___ from \"../../../node_modules/css-loader/dist/runtime/api.js\";\nvar ___CSS_LOADER_EXPORT___ = ___CSS_LOADER_API_IMPORT___(___CSS_LOADER_API_NO_SOURCEMAP_IMPORT___);\n// Module\n___CSS_LOADER_EXPORT___.push([module.id, \".role[data-v-3b5921fe]{display:flex;align-items:center;flex-direction:row}\", \"\"]);\n// Exports\nexport default ___CSS_LOADER_EXPORT___;\n"],"names":["key","class","_createElementBlock","$data","loading","_createBlock","_component_Loading","_hoisted_1","_createVNode","_component_ArrayList","value","members","_cache","$event","addAllowed","disableEdit","removeAllowed","_withCtx","_createElementVNode","_hoisted_2","_hoisted_3","_hoisted_4","_hoisted_5","_toDisplayString","_ctx","t","_hoisted_6","_hoisted_7","columns","row","i","_hoisted_8","_hoisted_9","_component_Principal","principalId","_hoisted_10","role","add","type","onClick","args","$options","openAddMemberDialog","remove","removeMember","_hoisted_11","_","components","ArrayList","Principal","Loading","SelectPrincipal","props","Object","data","workspace","watch","handler","this","loadMembers","deep","computed","mapGetters","created","fleetWorkspaceId","$route","params","id","Promise","all","$store","dispatch","Error","methods","annotations","metadata","entries","filter","startsWith","map","parts","split","userID","getters","component","componentProps","onAdd","addMember","modalWidth","modalSticky","principalIdSplit","random","Math","toString","substring","Date","now","updateAnnotations","index","member","oldannotations","save","error","title","message","root","__exports__","render","content","__esModule","default","module","locals","exports","___CSS_LOADER_EXPORT___","push"],"sourceRoot":""}