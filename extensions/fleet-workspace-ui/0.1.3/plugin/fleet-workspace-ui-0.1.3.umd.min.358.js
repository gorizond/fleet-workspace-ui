(("undefined"!==typeof self?self:this)["webpackChunkfleet_workspace_ui_0_1_3"]=("undefined"!==typeof self?self:this)["webpackChunkfleet_workspace_ui_0_1_3"]||[]).push([[358],{824:function(e,t,a){var o=a(7179);o.__esModule&&(o=o.default),"string"===typeof o&&(o=[[e.id,o,""]]),o.locals&&(e.exports=o.locals);var s=a(4825).A;s("3f478230",o,!0,{sourceMap:!1,shadowMode:!1})},5358:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return N}});var o=a(9274);const s={key:1},r={class:"box mb-0"},n={class:"column-headers row"},l={class:"col span-4"},i={class:"text-label"},d={class:"col span-4"},c={class:"text-label"},p={class:"columns row"},m={class:"col span-4"},u={class:"col span-4 role"},h={class:"col span-4 role"},b=["onClick"];function w(e,t,a,w,v,g){const y=(0,o.resolveComponent)("Loading"),k=(0,o.resolveComponent)("Principal"),f=(0,o.resolveComponent)("ArrayList");return(0,o.openBlock)(),(0,o.createElementBlock)("div",null,[v.loading?((0,o.openBlock)(),(0,o.createBlock)(y,{key:0})):((0,o.openBlock)(),(0,o.createElementBlock)("div",s,[(0,o.createVNode)(f,{value:v.members,"onUpdate:value":t[1]||(t[1]=e=>v.members=e),addAllowed:!v.disableEdit,removeAllowed:!v.disableEdit,"show-header":!0},{"column-headers":(0,o.withCtx)((()=>[(0,o.createElementVNode)("div",r,[(0,o.createElementVNode)("div",n,[(0,o.createElementVNode)("div",l,[(0,o.createElementVNode)("label",i,(0,o.toDisplayString)(e.t("membershipEditor.user")),1)]),(0,o.createElementVNode)("div",d,[(0,o.createElementVNode)("label",c,(0,o.toDisplayString)(e.t("membershipEditor.role")),1)]),t[2]||(t[2]=(0,o.createElementVNode)("div",{class:"col span-4"},[(0,o.createElementVNode)("label",{class:"text-label"},"Type")],-1))])])])),columns:(0,o.withCtx)((({row:e,i:t})=>[(0,o.createElementVNode)("div",p,[(0,o.createElementVNode)("div",m,[(0,o.createVNode)(k,{value:e.value.principalId},null,8,["value"])]),(0,o.createElementVNode)("div",u,(0,o.toDisplayString)(e.value.role),1),(0,o.createElementVNode)("div",h,(0,o.toDisplayString)(e.value.type),1)])])),add:(0,o.withCtx)((()=>[(0,o.createElementVNode)("button",{type:"button",class:"btn role-primary mt-10",onClick:t[0]||(t[0]=(...e)=>g.openAddMemberDialog&&g.openAddMemberDialog(...e))},(0,o.toDisplayString)(e.t("generic.add")),1)])),"remove-button":(0,o.withCtx)((({remove:t,i:a})=>[(0,o.createElementVNode)("button",{type:"button",class:"btn role-secondary mt-10",onClick:e=>g.removeMember(a)},(0,o.toDisplayString)(e.t("generic.remove")),9,b)])),_:1},8,["value","addAllowed","removeAllowed"])]))])}var v=a(5359),g=a(2017),y=a(4307),k=a(4409),f=a(6968),E={components:{ArrayList:g.A,Principal:y.A,Loading:k.A,SelectPrincipal:f.A},props:{value:Object},data(){return{loading:!0,members:[],workspace:Object,disableEdit:!0}},watch:{"workspace.metadata.annotations":{handler(){this.loadMembers()},deep:!0}},computed:{...(0,v.L8)(["currentCluster"])},async created(){const e=this.$route.params.id;if([this.workspace]=await Promise.all([this.$store.dispatch("management/find",{type:"management.cattle.io.fleetworkspace",id:e})]),!this.workspace)throw new Error("Failed to fetch fleet workspace");await this.loadMembers(),this.loading=!1},methods:{async loadMembers(){const e=this.workspace?.metadata?.annotations||{};let t=!0,a=[],o=Object.entries(e).filter((([e])=>e.startsWith("gorizond-user."))).map((([e,a])=>{const o=e.split("."),s=o[1],r=o[2];return s!==this.$store.getters["auth/v3User"].id||"admin"!==r&&"editor"!==r||(t=!1),{principalId:a,ID:s,type:"user",role:r}})),s=Object.entries(e).filter((([e])=>e.startsWith("gorizond-group."))).map((([e,t])=>{const a=e.split("."),o=a[1],s=a[2];return{principalId:t,ID:o,type:"group",role:s}}));this.disableEdit=t,0!==o.length&&(a=a.concat(o)),0!==s.length&&(a=a.concat(s)),this.members=a},async openAddMemberDialog(){this.$store.dispatch("cluster/promptModal",{component:"AddFleetMemberDialog",componentProps:{onAdd:this.addMember},modalWidth:"600px",modalSticky:!0})},async addMember(e,t){const a=e.split("://");let o=e,s=`gorizond-user.${a[1]}.${t}`;if("local"!==a[0]){let a=Math.random().toString(36).substring(2)+Date.now();s=`gorizond-principal.${a}.${t}`,o=e}const r={...this.workspace.metadata.annotations,[s]:o};await this.updateAnnotations(r)},async removeMember(e){const t=this.members[e],a=`gorizond-${t.type}.${t.ID}.${t.role}`,o={...this.workspace.metadata.annotations};delete o[a],await this.updateAnnotations(o)},async updateAnnotations(e){let t=this.workspace.metadata.annotations;try{this.workspace.metadata.annotations=e,await this.workspace.save()}catch(a){this.$store.dispatch("growl/error",{title:"Error",message:a.message},{root:!0}),this.workspace.metadata.annotations=t}}}},A=(a(824),a(7433));const M=(0,A.A)(E,[["render",w],["__scopeId","data-v-97a6e274"]]);var N=M},7179:function(e,t,a){"use strict";a.r(t);var o=a(6758),s=a.n(o),r=a(6173),n=a.n(r),l=n()(s());l.push([e.id,".role[data-v-97a6e274]{display:flex;align-items:center;flex-direction:row}",""]),t["default"]=l}}]);
//# sourceMappingURL=fleet-workspace-ui-0.1.3.umd.min.358.js.map