{"version":3,"file":"fleet-workspace-ui-0.1.3.umd.min.358.js","mappings":"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","sources":["webpack://fleet-workspace-ui-0.1.3/./components/FleetMembershipEditor.vue?a46c","webpack://fleet-workspace-ui-0.1.3/./components/FleetMembershipEditor.vue","webpack://fleet-workspace-ui-0.1.3/./components/FleetMembershipEditor.vue?41da","webpack://fleet-workspace-ui-0.1.3/./components/FleetMembershipEditor.vue?ea59"],"sourcesContent":["// style-loader: Adds some css to the DOM by adding a <style> tag\n\n// load the styles\nvar content = require(\"!!../../../node_modules/css-loader/dist/cjs.js??clonedRuleSet-13.use[1]!../../../node_modules/vue-loader/dist/stylePostLoader.js!../../../node_modules/postcss-loader/dist/cjs.js??clonedRuleSet-13.use[2]!../../../node_modules/postcss-loader/dist/cjs.js??clonedRuleSet-13.use[3]!../../../node_modules/cache-loader/dist/cjs.js??ruleSet[0].use[0]!../../../node_modules/vue-loader/dist/index.js??ruleSet[0].use[1]!./FleetMembershipEditor.vue?vue&type=style&index=0&id=97a6e274&scoped=true&lang=css\");\nif(content.__esModule) content = content.default;\nif(typeof content === 'string') content = [[module.id, content, '']];\nif(content.locals) module.exports = content.locals;\n// add the styles to the DOM\nvar add = require(\"!../../../node_modules/vue-style-loader/lib/addStylesClient.js\").default\nvar update = add(\"3f478230\", content, true, {\"sourceMap\":false,\"shadowMode\":false});","<template>\n  <div>\n    <Loading v-if=\"loading\" />\n    <div v-else>\n      <ArrayList\n          v-model:value=\"members\"\n          :addAllowed=\"!disableEdit\"\n          :removeAllowed=\"!disableEdit\"\n          :show-header=\"true\"\n      >\n        <template #column-headers>\n          <div class=\"box mb-0\">\n            <div class=\"column-headers row\">\n              <div class=\"col span-4\">\n                <label class=\"text-label\">{{ t('membershipEditor.user') }}</label>\n              </div>\n              <div class=\"col span-4\">\n                <label class=\"text-label\">{{ t('membershipEditor.role') }}</label>\n              </div>\n              <div class=\"col span-4\">\n                <label class=\"text-label\">Type</label>\n              </div>\n            </div>\n          </div>\n        </template>\n        <template #columns=\"{ row, i }\">\n          <div class=\"columns row\">\n            <div class=\"col span-4\">\n              <Principal :value=\"row.value.principalId\" />\n            </div>\n            <div class=\"col span-4 role\">\n              {{ row.value.role }}\n            </div>\n            <div class=\"col span-4 role\">\n              {{ row.value.type }}\n            </div>\n          </div>\n        </template>\n        <template #add>\n          <button\n              type=\"button\"\n              class=\"btn role-primary mt-10 \"\n              @click=\"openAddMemberDialog\"\n          >\n            {{ t('generic.add') }}\n          </button>\n        </template>\n        <template #remove-button=\"{ remove, i }\">\n          <button\n              type=\"button\"\n              class=\"btn role-secondary mt-10\"\n              @click=\"removeMember(i)\"\n          >\n            {{ t('generic.remove') }}\n          </button>\n        </template>\n      </ArrayList>\n    </div>\n  </div>\n</template>\n\n<script>\nimport { mapGetters } from 'vuex';\nimport ArrayList from '@shell/components/form/ArrayList';\nimport Principal from '@shell/components/auth/Principal';\nimport Loading from '@shell/components/Loading';\nimport SelectPrincipal from '@shell/components/auth/SelectPrincipal';\n\nexport default {\n  components: {\n    ArrayList,\n    Principal,\n    Loading,\n    SelectPrincipal,\n  },\n  props: {\n    value: Object,\n  },\n  data() {\n    return {\n      loading: true,\n      members: [],\n      workspace: Object,\n      disableEdit: true,\n    };\n  },\n  watch: {\n    'workspace.metadata.annotations': {\n      handler() {\n        this.loadMembers();\n      },\n      deep: true,\n    },\n  },\n  computed: {\n    ...mapGetters(['currentCluster']),\n  },\n  async created() {\n    const fleetWorkspaceId = this.$route.params.id;\n    [this.workspace] = await Promise.all([ this.$store.dispatch('management/find', {\n      type: 'management.cattle.io.fleetworkspace',\n      id: fleetWorkspaceId,\n    })]);\n    if (!this.workspace) {\n      throw new Error('Failed to fetch fleet workspace');\n    }\n    await this.loadMembers();\n    this.loading = false;\n  },\n  methods: {\n    async loadMembers() {\n      const annotations = this.workspace?.metadata?.annotations || {};\n      let disableEdit = true\n      let list = []\n      let tmpMembers = Object.entries(annotations)\n          .filter(([key]) => key.startsWith('gorizond-user.'))\n          .map(([key, value]) => {\n            const parts = key.split('.');\n            const userID = parts[1];\n            const role = parts[2];\n            if (userID === this.$store.getters['auth/v3User'].id && (role === 'admin' ||role === 'editor')) {\n              disableEdit = false;\n            }\n            return {\n              principalId: value,\n              ID: userID,\n              type: \"user\",\n              role: role,\n            };\n          });\n      let tmpGroups = Object.entries(annotations)\n          .filter(([key]) => key.startsWith('gorizond-group.'))\n          .map(([key, value]) => {\n            const parts = key.split('.');\n            const group = parts[1];\n            const role = parts[2];\n            return {\n              principalId: value,\n              ID: group,\n              type: \"group\",\n              role: role,\n            };\n          });\n      this.disableEdit = disableEdit;\n      if (tmpMembers.length !== 0) {\n        list = list.concat(tmpMembers);\n      }\n      if (tmpGroups.length !== 0) {\n        list = list.concat(tmpGroups);\n      }\n      this.members = list\n    },\n    async openAddMemberDialog() {\n      this.$store.dispatch('cluster/promptModal', {\n        component: 'AddFleetMemberDialog',\n        componentProps: {\n          onAdd: this.addMember,\n        },\n        modalWidth: '600px',\n        modalSticky: true,\n      });\n    },\n    async addMember(principalId, role) {\n      const principalIdSplit = principalId.split('://');\n      let value = principalId;\n      let key = `gorizond-user.${principalIdSplit[1]}.${role}`;\n      if (principalIdSplit[0] !== 'local') {\n        let random = Math.random().toString(36).substring(2) + Date.now();\n        key = `gorizond-principal.${random}.${role}`;\n        value = principalId;\n      }\n      const annotations = {\n        ...this.workspace.metadata.annotations,\n        [key]: value,\n      };\n      await this.updateAnnotations(annotations);\n    },\n    async removeMember(index) {\n      const member = this.members[index];\n      const key = `gorizond-${member.type}.${member.ID}.${member.role}`;\n      const annotations = { ...this.workspace.metadata.annotations };\n      delete annotations[key];\n      await this.updateAnnotations(annotations);\n    },\n    async updateAnnotations(annotations) {\n      let oldannotations = this.workspace.metadata.annotations\n      try {\n        this.workspace.metadata.annotations = annotations;\n        await this.workspace.save();\n      } catch (error) {\n        this.$store.dispatch('growl/error', {\n          title:   'Error',\n          message: error.message,\n        }, { root: true });\n        this.workspace.metadata.annotations = oldannotations;\n      }\n    },\n  },\n};\n</script>\n\n<style scoped>\n.role {\n  display: flex;\n  align-items: center;\n  flex-direction: row;\n}\n</style>\n","import { render } from \"./FleetMembershipEditor.vue?vue&type=template&id=97a6e274&scoped=true\"\nimport script from \"./FleetMembershipEditor.vue?vue&type=script&lang=js\"\nexport * from \"./FleetMembershipEditor.vue?vue&type=script&lang=js\"\n\nimport \"./FleetMembershipEditor.vue?vue&type=style&index=0&id=97a6e274&scoped=true&lang=css\"\n\nimport exportComponent from \"../../../node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render],['__scopeId',\"data-v-97a6e274\"]])\n\nexport default __exports__","// Imports\nimport ___CSS_LOADER_API_NO_SOURCEMAP_IMPORT___ from \"../../../node_modules/css-loader/dist/runtime/noSourceMaps.js\";\nimport ___CSS_LOADER_API_IMPORT___ from \"../../../node_modules/css-loader/dist/runtime/api.js\";\nvar ___CSS_LOADER_EXPORT___ = ___CSS_LOADER_API_IMPORT___(___CSS_LOADER_API_NO_SOURCEMAP_IMPORT___);\n// Module\n___CSS_LOADER_EXPORT___.push([module.id, \".role[data-v-97a6e274]{display:flex;align-items:center;flex-direction:row}\", \"\"]);\n// Exports\nexport default ___CSS_LOADER_EXPORT___;\n"],"names":["content","__esModule","default","module","id","locals","exports","add","key","class","_createElementBlock","$data","loading","_createBlock","_component_Loading","_hoisted_1","_createVNode","_component_ArrayList","value","members","_cache","$event","addAllowed","disableEdit","removeAllowed","_withCtx","_createElementVNode","_hoisted_2","_hoisted_3","_hoisted_4","_hoisted_5","_toDisplayString","_ctx","t","_hoisted_6","_hoisted_7","columns","row","i","_hoisted_8","_hoisted_9","_component_Principal","principalId","_hoisted_10","role","_hoisted_11","type","onClick","args","$options","openAddMemberDialog","remove","removeMember","_hoisted_12","_","components","ArrayList","Principal","Loading","SelectPrincipal","props","Object","data","workspace","watch","handler","this","loadMembers","deep","computed","mapGetters","created","fleetWorkspaceId","$route","params","Promise","all","$store","dispatch","Error","methods","annotations","metadata","list","tmpMembers","entries","filter","startsWith","map","parts","split","userID","getters","ID","tmpGroups","group","length","concat","component","componentProps","onAdd","addMember","modalWidth","modalSticky","principalIdSplit","random","Math","toString","substring","Date","now","updateAnnotations","index","member","oldannotations","save","error","title","message","root","__exports__","render","___CSS_LOADER_EXPORT___","push"],"sourceRoot":""}