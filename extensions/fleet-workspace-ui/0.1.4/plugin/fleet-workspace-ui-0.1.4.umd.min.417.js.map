{"version":3,"file":"fleet-workspace-ui-0.1.4.umd.min.417.js","mappings":"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","sources":["webpack://fleet-workspace-ui-0.1.4/./components/FleetMembershipEditor.vue","webpack://fleet-workspace-ui-0.1.4/./components/FleetMembershipEditor.vue?41da","webpack://fleet-workspace-ui-0.1.4/./components/FleetMembershipEditor.vue?493d","webpack://fleet-workspace-ui-0.1.4/./components/FleetMembershipEditor.vue?fb14"],"sourcesContent":["<template>\n  <div>\n    <Loading v-if=\"loading\" />\n    <div v-else>\n      <ArrayList\n          v-model:value=\"members\"\n          :addAllowed=\"!disableEdit\"\n          :removeAllowed=\"!disableEdit\"\n          :show-header=\"true\"\n      >\n        <template #column-headers>\n          <div class=\"box mb-0\">\n            <div class=\"column-headers row\">\n              <div class=\"col span-4\">\n                <label class=\"text-label\">{{ t('membershipEditor.user') }}</label>\n              </div>\n              <div class=\"col span-4\">\n                <label class=\"text-label\">{{ t('membershipEditor.role') }}</label>\n              </div>\n              <div class=\"col span-4\">\n                <label class=\"text-label\">Type</label>\n              </div>\n            </div>\n          </div>\n        </template>\n        <template #columns=\"{ row, i }\">\n          <div class=\"columns row\">\n            <div class=\"col span-4\">\n              <Principal :value=\"row.value.principalId\" />\n            </div>\n            <div class=\"col span-4 role\">\n              {{ row.value.role }}\n            </div>\n            <div class=\"col span-4 role\">\n              {{ row.value.type }}\n            </div>\n          </div>\n        </template>\n        <template #add>\n          <button\n              type=\"button\"\n              class=\"btn role-primary mt-10 \"\n              @click=\"openAddMemberDialog\"\n          >\n            {{ t('generic.add') }}\n          </button>\n        </template>\n        <template #remove-button=\"{ remove, i }\">\n          <button\n              type=\"button\"\n              class=\"btn role-secondary mt-10\"\n              @click=\"removeMember(i)\"\n          >\n            {{ t('generic.remove') }}\n          </button>\n        </template>\n      </ArrayList>\n    </div>\n  </div>\n</template>\n\n<script>\nimport { mapGetters } from 'vuex';\nimport ArrayList from '@shell/components/form/ArrayList';\nimport Principal from '@shell/components/auth/Principal';\nimport Loading from '@shell/components/Loading';\nimport SelectPrincipal from '@shell/components/auth/SelectPrincipal';\n\nexport default {\n  components: {\n    ArrayList,\n    Principal,\n    Loading,\n    SelectPrincipal,\n  },\n  props: {\n    value: Object,\n  },\n  data() {\n    return {\n      loading: true,\n      members: [],\n      workspace: Object,\n      disableEdit: true,\n      isAdmin: false,\n    };\n  },\n  watch: {\n    'workspace.metadata.annotations': {\n      handler() {\n        this.loadMembers();\n      },\n      deep: true,\n    },\n  },\n  computed: {\n    ...mapGetters(['currentCluster']),\n  },\n  async created() {\n    const fleetWorkspaceId = this.$route.params.id;\n    [this.workspace] = await Promise.all([ this.$store.dispatch('management/find', {\n      type: 'management.cattle.io.fleetworkspace',\n      id: fleetWorkspaceId,\n    })]);\n    if (!this.workspace) {\n      throw new Error('Failed to fetch fleet workspace');\n    }\n    await this.loadMembers();\n    this.checkAdminStatus();\n    this.loading = false;\n  },\n  methods: {\n    checkAdminStatus() {\n      const labels = this.$store.getters['auth/v3User']?.labels;\n      if (labels) {\n        if (labels[\"authz.management.cattle.io/bootstrapping\"] === \"admin-user\") {\n          this.isAdmin = true;\n          this.disableEdit = false;\n        }\n      }\n    },\n    async loadMembers() {\n      const annotations = this.workspace?.metadata?.annotations || {};\n      let disableEdit = true\n      let list = []\n      let tmpMembers = Object.entries(annotations)\n          .filter(([key]) => key.startsWith('gorizond-user.'))\n          .map(([key, value]) => {\n            const parts = key.split('.');\n            const userID = parts[1];\n            const role = parts[2];\n            if (userID === this.$store.getters['auth/v3User'].id && (role === 'admin' ||role === 'editor')) {\n              disableEdit = false;\n            }\n            return {\n              principalId: value,\n              ID: userID,\n              type: \"user\",\n              role: role,\n            };\n          });\n      let tmpGroups = Object.entries(annotations)\n          .filter(([key]) => key.startsWith('gorizond-group.'))\n          .map(([key, value]) => {\n            const parts = key.split('.');\n            const group = parts[1];\n            const role = parts[2];\n            return {\n              principalId: value,\n              ID: group,\n              type: \"group\",\n              role: role,\n            };\n          });\n      if (this.isAdmin) {\n        this.disableEdit = false;\n      } else {\n        this.disableEdit = disableEdit;\n      }\n      if (tmpMembers.length !== 0) {\n        list = list.concat(tmpMembers);\n      }\n      if (tmpGroups.length !== 0) {\n        list = list.concat(tmpGroups);\n      }\n      this.members = list\n    },\n    async openAddMemberDialog() {\n      this.$store.dispatch('cluster/promptModal', {\n        component: 'AddFleetMemberDialog',\n        componentProps: {\n          onAdd: this.addMember,\n        },\n        modalWidth: '600px',\n        modalSticky: true,\n      });\n    },\n    async addMember(principalId, role) {\n      const principalIdSplit = principalId.split('://');\n      let value = principalId;\n      let key = `gorizond-user.${principalIdSplit[1]}.${role}`;\n      if (principalIdSplit[0] !== 'local') {\n        let random = Math.random().toString(36).substring(2) + Date.now();\n        key = `gorizond-principal.${random}.${role}`;\n        value = principalId;\n      }\n      const annotations = {\n        ...this.workspace.metadata.annotations,\n        [key]: value,\n      };\n      await this.updateAnnotations(annotations);\n    },\n    async removeMember(index) {\n      const member = this.members[index];\n      const key = `gorizond-${member.type}.${member.ID}.${member.role}`;\n      const annotations = { ...this.workspace.metadata.annotations };\n      delete annotations[key];\n      await this.updateAnnotations(annotations);\n    },\n    async updateAnnotations(annotations) {\n      let oldAnnotations = this.workspace.metadata.annotations\n      try {\n        this.workspace.metadata.annotations = annotations;\n        await this.workspace.save();\n      } catch (error) {\n        this.$store.dispatch('growl/error', {\n          title:   'Error',\n          message: error.message,\n        }, { root: true });\n        this.workspace.metadata.annotations = oldAnnotations;\n      }\n    },\n  },\n};\n</script>\n\n<style scoped>\n.role {\n  display: flex;\n  align-items: center;\n  flex-direction: row;\n}\n</style>","import { render } from \"./FleetMembershipEditor.vue?vue&type=template&id=fae5d8ce&scoped=true\"\nimport script from \"./FleetMembershipEditor.vue?vue&type=script&lang=js\"\nexport * from \"./FleetMembershipEditor.vue?vue&type=script&lang=js\"\n\nimport \"./FleetMembershipEditor.vue?vue&type=style&index=0&id=fae5d8ce&scoped=true&lang=css\"\n\nimport exportComponent from \"../../../node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render],['__scopeId',\"data-v-fae5d8ce\"]])\n\nexport default __exports__","// style-loader: Adds some css to the DOM by adding a <style> tag\n\n// load the styles\nvar content = require(\"!!../../../node_modules/css-loader/dist/cjs.js??clonedRuleSet-13.use[1]!../../../node_modules/vue-loader/dist/stylePostLoader.js!../../../node_modules/postcss-loader/dist/cjs.js??clonedRuleSet-13.use[2]!../../../node_modules/postcss-loader/dist/cjs.js??clonedRuleSet-13.use[3]!../../../node_modules/cache-loader/dist/cjs.js??ruleSet[0].use[0]!../../../node_modules/vue-loader/dist/index.js??ruleSet[0].use[1]!./FleetMembershipEditor.vue?vue&type=style&index=0&id=fae5d8ce&scoped=true&lang=css\");\nif(content.__esModule) content = content.default;\nif(typeof content === 'string') content = [[module.id, content, '']];\nif(content.locals) module.exports = content.locals;\n// add the styles to the DOM\nvar add = require(\"!../../../node_modules/vue-style-loader/lib/addStylesClient.js\").default\nvar update = add(\"6aefff2c\", content, true, {\"sourceMap\":false,\"shadowMode\":false});","// Imports\nimport ___CSS_LOADER_API_NO_SOURCEMAP_IMPORT___ from \"../../../node_modules/css-loader/dist/runtime/noSourceMaps.js\";\nimport ___CSS_LOADER_API_IMPORT___ from \"../../../node_modules/css-loader/dist/runtime/api.js\";\nvar ___CSS_LOADER_EXPORT___ = ___CSS_LOADER_API_IMPORT___(___CSS_LOADER_API_NO_SOURCEMAP_IMPORT___);\n// Module\n___CSS_LOADER_EXPORT___.push([module.id, \".role[data-v-fae5d8ce]{display:flex;align-items:center;flex-direction:row}\", \"\"]);\n// Exports\nexport default ___CSS_LOADER_EXPORT___;\n"],"names":["key","class","_createElementBlock","$data","loading","_createBlock","_component_Loading","_hoisted_1","_createVNode","_component_ArrayList","value","members","_cache","$event","addAllowed","disableEdit","removeAllowed","_withCtx","_createElementVNode","_hoisted_2","_hoisted_3","_hoisted_4","_hoisted_5","_toDisplayString","_ctx","t","_hoisted_6","_hoisted_7","columns","row","i","_hoisted_8","_hoisted_9","_component_Principal","principalId","_hoisted_10","role","_hoisted_11","type","add","onClick","args","$options","openAddMemberDialog","remove","removeMember","_hoisted_12","_","components","ArrayList","Principal","Loading","SelectPrincipal","props","Object","data","workspace","isAdmin","watch","handler","this","loadMembers","deep","computed","mapGetters","created","fleetWorkspaceId","$route","params","id","Promise","all","$store","dispatch","Error","checkAdminStatus","methods","labels","getters","annotations","metadata","list","tmpMembers","entries","filter","startsWith","map","parts","split","userID","ID","tmpGroups","group","length","concat","component","componentProps","onAdd","addMember","modalWidth","modalSticky","principalIdSplit","random","Math","toString","substring","Date","now","updateAnnotations","index","member","oldAnnotations","save","error","title","message","root","__exports__","render","content","__esModule","default","module","locals","exports","___CSS_LOADER_EXPORT___","push"],"sourceRoot":""}