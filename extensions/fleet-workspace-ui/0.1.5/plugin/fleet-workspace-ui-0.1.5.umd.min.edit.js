(("undefined"!==typeof self?self:this)["webpackChunkfleet_workspace_ui_0_1_5"]=("undefined"!==typeof self?self:this)["webpackChunkfleet_workspace_ui_0_1_5"]||[]).push([[739],{27691:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return _}});var r=a(9274);const s={key:0},o={key:1};function i(e,t,a,i,n,l){const c=(0,r.resolveComponent)("Loading"),m=(0,r.resolveComponent)("NameNsDescription"),p=(0,r.resolveComponent)("Banner"),d=(0,r.resolveComponent)("RoleBindings"),u=(0,r.resolveComponent)("Tab"),h=(0,r.resolveComponent)("Labels"),f=(0,r.resolveComponent)("t"),k=(0,r.resolveComponent)("ArrayList"),w=(0,r.resolveComponent)("Tabbed"),v=(0,r.resolveComponent)("CruResource");return e.$fetchState.pending?((0,r.openBlock)(),(0,r.createBlock)(c,{key:0})):((0,r.openBlock)(),(0,r.createBlock)(v,{key:1,"done-route":e.doneRoute,mode:e.mode,resource:e.value,subtypes:[],"validation-passed":!0,errors:e.errors,onError:t[4]||(t[4]=t=>e.errors=t),onFinish:l.saveAll,onCancel:e.done},{default:(0,r.withCtx)((()=>[(0,r.createVNode)(m,{value:e.value,mode:e.mode,namespaced:!1,"onUpdate:value":t[0]||(t[0]=t=>e.$emit("input",t))},null,8,["value","mode"]),e.isCreate&&(n.workspacePrefix||l.workspaceNamePreview)?((0,r.openBlock)(),(0,r.createBlock)(p,{key:0,color:"info",class:"mb-20"},{default:(0,r.withCtx)((()=>[n.workspacePrefix?((0,r.openBlock)(),(0,r.createElementBlock)("div",s,(0,r.toDisplayString)(e.t("fleet-workspace-ui.workspacePrefix.message",{prefix:n.workspacePrefix})),1)):(0,r.createCommentVNode)("",!0),l.workspaceNamePreview?((0,r.openBlock)(),(0,r.createElementBlock)("div",o,(0,r.toDisplayString)(e.t("fleet-workspace-ui.workspacePrefix.preview",{name:l.workspaceNamePreview})),1)):(0,r.createCommentVNode)("",!0)])),_:1})):(0,r.createCommentVNode)("",!0),(0,r.createVNode)(w,{"side-tabs":!0,"default-tab":"members"},{default:(0,r.withCtx)((()=>[(0,r.createVNode)(u,{name:"members","label-key":"generic.members",weight:2},{default:(0,r.withCtx)((()=>[(0,r.createVNode)(d,{ref:"rb","register-after-hook":e.registerAfterHook,"role-scope":l.SCOPE_CLUSTER,"binding-scope":l.SCOPE_NAMESPACE,"filter-role-value":l.FLEET_NAME,namespace:e.value.name,mode:e.mode,"in-store":"management"},null,8,["register-after-hook","role-scope","binding-scope","filter-role-value","namespace","mode"])])),_:1}),(0,r.createVNode)(u,{name:"labels","label-key":"generic.labelsAndAnnotations"},{default:(0,r.withCtx)((()=>[(0,r.createVNode)(h,{value:e.value,mode:e.mode,"onUpdate:value":t[1]||(t[1]=t=>e.$emit("input",t))},null,8,["value","mode"])])),_:1}),(0,r.createVNode)(u,{name:"allowedtargetnamespaces","label-key":"fleet.workspaces.tabs.restrictions"},{default:(0,r.withCtx)((()=>[(0,r.createVNode)(p,{color:"info"},{default:(0,r.withCtx)((()=>[(0,r.createElementVNode)("div",null,[(0,r.createVNode)(f,{k:"fleet.restrictions.banner",count:l.allowedTargetNamespaces.length,raw:!0},null,8,["count"]),l.allowedTargetNamespaces.length?((0,r.openBlock)(),(0,r.createElementBlock)("a",{key:0,onClick:t[2]||(t[2]=e=>n.workSpaceRestriction.goToDetail())},(0,r.toDisplayString)(e.t("generic.here")),1)):(0,r.createCommentVNode)("",!0)])])),_:1}),(0,r.createVNode)(k,{key:"labels",value:l.allowedTargetNamespaces,"onUpdate:value":t[3]||(t[3]=e=>l.allowedTargetNamespaces=e),"add-label":e.t("fleet.restrictions.addLabel"),mode:e.mode,title:e.t("fleet.restrictions.addTitle"),"read-allowed":!1,"value-can-be-empty":!0},null,8,["value","add-label","mode","title"])])),_:1})])),_:1})])),_:1},8,["done-route","mode","resource","errors","onFinish","onCancel"]))}var n=a(2517),l=a(74233),c=a(80837),m=a(84409),p=a(32786),d=a(35664),u=a(59368),h=a(10006),f=a(49584),k=a(11876),w=a(65359),v=a(91462),g=a(99726),C=a(56943),N=a(4374),R=a(4364),T={name:"FleetCruWorkspace",emits:["input"],inheritAttrs:!1,components:{CruResource:l.A,Labels:c.A,Loading:m.A,NameNsDescription:p.A,RoleBindings:u.Ay,Tabbed:h.A,Tab:f.A,Banner:C.A,ArrayList:N.A},mixins:[n.A],async fetch(){if(this.rancherClusters=await this.$store.dispatch("management/findAll",{type:d.Mc.CLUSTER}),this.$store.getters["management/schemaFor"](d.Hs.CLUSTER)&&(this.fleetClusters=await this.$store.dispatch("management/findAll",{type:d.Hs.CLUSTER})),this.hasRepoRestrictionSchema){const e=await this.$store.dispatch("management/findAll",{type:d.Hs.GIT_REPO_RESTRICTION}),t=e.find((e=>e.metadata.namespace===this.value.metadata.name&&e.metadata.name.startsWith(`restriction-${this.value.metadata.name}`)));t&&(this.workSpaceRestriction=t)}this.restrictionsOptions=await this.$store.getters["type-map/optionsFor"](d.Hs.GIT_REPO_RESTRICTION),this.restrictionsSchema=await this.$store.getters["management/schemaFor"](d.Hs.GIT_REPO_RESTRICTION),this.workspacePrefix=await this.loadWorkspacePrefix()},data(){return this.value["spec"]=this.value.spec||{},{fleetClusters:null,rancherClusters:null,workSpaceRestriction:null,restrictions:[],targetNamespaces:[],restrictionsSchema:{spec:{}},namespace:this.$store.getters["prefs/get"](v.Ri),hasRepoRestrictionSchema:!!this.$store.getters["management/schemaFor"](d.Hs.GIT_REPO_RESTRICTION),workspacePrefix:""}},methods:{async saveAll(e){try{if(this.isCreate){this.value.metadata=this.value.metadata||{};const e=this.value.metadata?.name||this.value.name,t=this.applyWorkspacePrefix(e);this.value.metadata.name=t,this.value.name=t}if(await this.value.save(),this.workSpaceRestriction&&await this.workSpaceRestriction.save(),!this.workSpaceRestriction&&this.targetNamespaces.length){this.hasRepoRestrictionSchema||await this.$store.dispatch("management/find",{type:d.yx,id:d.Hs.GIT_REPO_RESTRICTION},{force:!0});const e=await this.$store.dispatch("management/create",{type:d.Hs.GIT_REPO_RESTRICTION,allowedTargetNamespaces:this.targetNamespaces,metadata:{name:`restriction-${this.value.metadata.name}-${Date.now()}`,namespace:this.value.metadata.name}});await e.save()}await this.value.waitForWorkspaceSchema(2e4,(e=>e.collectionMethods?.includes("GET"))),await this.$store.dispatch("management/findAll",{type:d.Hs.WORKSPACE}),this.$store.commit("updateWorkspace",{value:this.value.metadata.name,getters:this.$store.getters}),this.$store.dispatch("prefs/set",{key:v.un,value:this.value.metadata.name}),e(!0),this.done()}catch(t){R.error(t),e(!1),this.errors=(0,g.rz)(t)}},applyWorkspacePrefix(e=""){return this.workspacePrefix?e.startsWith(this.workspacePrefix)?e:`${this.workspacePrefix}${e}`:e},async loadWorkspacePrefix(){try{const e=await this.$store.dispatch("management/find",{type:d.Mc.SETTING,id:"gorizond-workspace-prefix"}),t="string"===typeof e?.value?e.value.trim():"";return t}catch(e){return R.error("Failed to load workspace prefix setting",e),""}}},computed:{...(0,w.aH)(["allWorkspaces","workspace"]),allowedTargetNamespaces:{get(){return this.workSpaceRestriction?.allowedTargetNamespaces||[]},set(e){this.workSpaceRestriction&&(this.workSpaceRestriction.allowedTargetNamespaces=e),this.targetNamespaces=e}},workspaceNamePreview(){if(!this.isCreate)return"";const e=this.value?.metadata?.name||"";return e||this.workspacePrefix?this.applyWorkspacePrefix(e):""},SCOPE_NAMESPACE(){return u.Tc},SCOPE_CLUSTER(){return u.Op},FLEET_NAME(){return k.o_}}},y=a(47433);const E=(0,y.A)(T,[["render",i]]);var _=E},39989:function(e,t,a){var r={"./management.cattle.io.fleetworkspace":75593,"./management.cattle.io.fleetworkspace.vue":75593,"./management.cattle.io.globalrole":39126,"./management.cattle.io.globalrole.vue":39126,"./management.cattle.io.project":11193,"./management.cattle.io.project.vue":11193,"./management.cattle.io.roletemplate":24093,"./management.cattle.io.roletemplate.vue":24093,"./mixin/roleDeletionCheck":95361,"./mixin/roleDeletionCheck.js":95361,"./pod":4563,"./pod.vue":4563};function s(e){var t=o(e);return a(t)}function o(e){if(!a.o(r,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return r[e]}s.keys=function(){return Object.keys(r)},s.resolve=o,e.exports=s,s.id=39989},93558:function(e,t,a){var r={"./csp/metadata.json":6471,"./federal/metadata.json":91862,"./harvester/metadata.json":51507,"./rgs/metadata.json":48401,"./suse/metadata.json":37259};function s(e){var t=o(e);return a(t)}function o(e){if(!a.o(r,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return r[e]}s.keys=function(){return Object.keys(r)},s.resolve=o,e.exports=s,s.id=93558}}]);
//# sourceMappingURL=fleet-workspace-ui-0.1.5.umd.min.edit.js.map